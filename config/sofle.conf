# ZMK Configuration for White Sofle Keyboard
# Enhanced BLE connectivity and stability settings

# ==============================================================================
# POWER MANAGEMENT
# ==============================================================================

# Enable deep sleep to save battery
CONFIG_ZMK_SLEEP=y

# Deep sleep timeout (30 minutes of inactivity)
CONFIG_ZMK_IDLE_SLEEP_TIMEOUT=1800000

# ==============================================================================
# BLUETOOTH CONFIGURATION
# ==============================================================================

# Increase wireless transmission power for better range
CONFIG_BT_CTLR_TX_PWR_PLUS_8=y

# Enhanced BLE connection stability (experimental)
CONFIG_ZMK_BLE_EXPERIMENTAL_CONN=y

# BLE connection interval settings for stability
CONFIG_BT_PERIPHERAL_PREF_MIN_INT=6
CONFIG_BT_PERIPHERAL_PREF_MAX_INT=12
CONFIG_BT_PERIPHERAL_PREF_LATENCY=0
CONFIG_BT_PERIPHERAL_PREF_TIMEOUT=400

# Enable passkey entry for secure pairing
CONFIG_ZMK_BLE_PASSKEY_ENTRY=y

# Increase maximum number of paired devices
CONFIG_BT_MAX_PAIRED=5

# BLE advertising settings
CONFIG_ZMK_BLE_INIT_PRIORITY=41

# Clear bonds on startup (enable temporarily for troubleshooting)
# CONFIG_ZMK_BLE_CLEAR_BONDS_ON_START=y

# ==============================================================================
# KEYBOARD SCANNING & DEBOUNCING
# ==============================================================================

# Aggressive debouncing for responsive typing
CONFIG_ZMK_KSCAN_DEBOUNCE_PRESS_MS=1
CONFIG_ZMK_KSCAN_DEBOUNCE_RELEASE_MS=7

# ==============================================================================
# DISPLAY CONFIGURATION
# ==============================================================================

# Enable OLED display
CONFIG_ZMK_DISPLAY=y

# Display settings
CONFIG_ZMK_DISPLAY_INVERT=n
CONFIG_ZMK_WIDGET_LAYER_STATUS=y
CONFIG_ZMK_WIDGET_BATTERY_STATUS=y
CONFIG_ZMK_WIDGET_OUTPUT_STATUS=y
CONFIG_ZMK_WIDGET_WPM_STATUS=y

# ==============================================================================
# ENCODER SUPPORT
# ==============================================================================

# Enable rotary encoder support
CONFIG_EC11=y
CONFIG_EC11_TRIGGER_GLOBAL_THREAD=y

# ==============================================================================
# KEYBOARD IDENTITY
# ==============================================================================

# Set keyboard name (appears in Bluetooth device list)
CONFIG_ZMK_KEYBOARD_NAME="Way"

# ==============================================================================
# USB CONFIGURATION
# ==============================================================================

# USB HID polling rate (1000Hz for gaming)
CONFIG_USB_HID_POLL_INTERVAL_MS=1

# USB logging (disable for production to save power)
# CONFIG_ZMK_USB_LOGGING=y

# ==============================================================================
# ADDITIONAL STABILITY SETTINGS
# ==============================================================================

# Increase stack sizes for stability
CONFIG_MAIN_STACK_SIZE=2048
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=2048

# Enable USB boot protocol support
CONFIG_ZMK_HID_BOOT=y

# Split keyboard settings (if applicable)
CONFIG_ZMK_SPLIT_BLE_CENTRAL_BATTERY_LEVEL_FETCHING=y
CONFIG_ZMK_SPLIT_BLE_CENTRAL_BATTERY_LEVEL_PROXY=y

# ==============================================================================
# MEMORY OPTIMIZATION
# ==============================================================================

# Optimize memory usage
CONFIG_HEAP_MEM_POOL_SIZE=8192

# ==============================================================================
# TROUBLESHOOTING OPTIONS (UNCOMMENT AS NEEDED)
# ==============================================================================

# Enable for detailed logging (increases power consumption)
# CONFIG_ZMK_USB_LOGGING=y
# CONFIG_LOG=y
# CONFIG_ZMK_LOG_LEVEL_DBG=y

# Force clear all bonds (use temporarily if pairing issues persist)
# CONFIG_ZMK_BLE_CLEAR_BONDS_ON_START=y

# Disable 2M PHY if you have connection issues
# CONFIG_BT_CTLR_PHY_2M=n

# Additional Windows 11 compatibility
# CONFIG_BT_GATT_ENFORCE_SUBSCRIPTION=n